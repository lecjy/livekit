# Copyright 2024 LiveKit, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# LiveKit服务器的主TCP端口，用于RoomService和RTC端点，在生产环境中，此端口应位于负载均衡器后面并使用TLS加密
port: 7880

# 当配置了Redis时，LiveKit将自动以完全分布式模式运行，客户端可以连接到任何节点，并被路由到同一个房间
redis:
  # Redis服务器地址
  address: redis.host:6379
  # db: 0
  # username: myuser
  # password: mypassword
  # sentinel_master_name: livekit   # 如果要使用哨兵模式，请移除上面的address配置并添加以下配置
  # sentinel_addresses:
  # - livekit-redis-node-0.livekit-redis-headless:26379
  # - livekit-redis-node-1.livekit-redis-headless:26379
  # 如果哨兵使用不同的认证凭据，请添加以下配置
  # sentinel_username: user
  # sentinel_password: pass
  #
  # 为Redis启用TLS
  # tls:
  #   enabled: true  # 启用TLS
  #   insecure: false # 设置为true时，LiveKit将不验证服务器证书，默认为true
  #   server_name: myserver.com # 服务器名称，用于TLS验证
  #   ca_cert_file: /path/to/ca.crt # 用于验证的受信任根证书文件
  #   client_cert_file: /path/to/client.crt# 客户端证书文件
  #   client_key_file: /path/to/client.key # 客户端密钥文件
  #
  # 如果要使用集群模式，请移除上面的address配置并添加以下配置，它将使用上面的password作为集群密码，由于集群模式不支持，db配置将不会被使用
  # cluster_addresses:
  # - livekit-redis-node-0.livekit-redis-headless:6379
  # - livekit-redis-node-1.livekit-redis-headless:6380

# WebRTC配置
rtc:
  # 用于客户端流量的UDP端口范围，防火墙必须开放此端口范围的入站流量
  port_range_start: 50000
  port_range_end: 60000
  # 当UDP不可用时，LiveKit启用基于TCP的WebRTC ICE，此端口不能位于负载均衡器或TLS后面，必须在节点上直接暴露，WebRTC传输已加密，不需要额外的加密层，如果端口小于1024，则只允许使用公网IP的80/443端口
  tcp_port: 7881
  # 设置为true时，尝试通过STUN发现主机的公网IP，这对于AWS和Google等云环境很有用，主机有内部IP映射到外部IP
  use_external_ip: true
  # 在某些情况下，通过STUN确定的公网IP可能不正确，需要手动设置节点的公网IP，use_external_ip优先，要使此设置生效，请将use_external_ip设置为false
  # node_ip: <external-ip-of-node>
  # 设置后，LiveKit将尝试使用UDP复用，使所有UDP流量通过指定的端口。为了最大化系统性能，建议使用与机器vCPU数量，相等或更大的端口范围，要使此配置生效，不能设置port_range_start和end
  # udp_port: 7882-7892
  # 设置为true时，服务器将使用轻量级ICE代理，这可以加速ICE连接，但如果服务器运行在NAT后面可能会导致连接问题。
  # use_ice_lite: true
  # 为LiveKit客户端配置可选的STUN服务器。客户端将自动配置使用这些STUN服务器。默认情况下，LiveKit客户端使用Google的公共STUN服务器
  # stun_servers:
  #   - server1
  # 为客户端配置可选的TURN服务器。如果使用内置TURN服务器(见下文)，则不需要此配置。
  # turn_servers:
  #   - host: myhost.com
  #     port: 443
  #     protocol: tls # tls、tcp或udp协议
  #     secret: "" # TURN服务器认证的共享密钥
  #     ttl: 14400 # 有效期(秒)
  #     # 不安全的用户名/密码认证
  #     username: ""
  #     credential: ""
  # 允许LiveKit在发送流时监控拥塞，并自动管理带宽利用以避免拥塞/丢包
  # congestion_control:
  #   enabled: true # 默认启用
  #   allow_pause: true # 在网络高度拥塞的极端情况下，SFU可能会暂停某些轨道，以让其他轨道流畅传输。您可以在此禁用此行为
  # allow_tcp_fallback: true # 当UDP不稳定时，允许自动回退到TCP和TURN/TLS(如果配置了)，默认为true
  # packet_buffer_size_video: 500 # SFU中视频的缓冲包数量，默认为500
  # packet_buffer_size_audio: 200 # SFU中音频的缓冲包数量，默认为200
  # # 向单个生产者发送pli/fir rtcp包的最小间隔时间，增加这些时间可能导致新参与者加入时黑屏时间更长，减少则可能导致流比特率更高
  # pli_throttle:
  #   low_quality: 500ms
  #   mid_quality: 1s
  #   high_quality: 1s
  # enable_loopback_candidate: true  # 设置后，Livekit将收集回环候选地址，这对于某些虚拟机将公网地址映射到回环接口的情况很有用
  # # 网络接口过滤。如果机器有多个网络接口，您希望使用或跳过特定接口可以同时使用包含和排除过滤器。如果两者都未定义(默认)，将使用机器上的所有接口。如果同时设置了包含和排除，则只有包含生效。
  # interfaces:
  #   includes:
  #     - en0
  #   excludes:
  #     - docker0
  # # IP地址过滤。如果机器有多个IP地址，您希望使用或跳过特定IP，可以同时使用包含和排除CIDR过滤器。如果两者都未定义(默认)，将使用机器上的所有IP。如果同时设置了包含和排除，则只有包含生效
  # ips:
  #   includes:
  #     - 10.0.0.0/16
  #   excludes:
  #     - 192.168.1.0/24
  # use_mdns: true # 设置为true以启用mDNS名称候选。大多数用户应保持禁用。启用后会影响性能，因为每个PeerConnection将独立处理相同的mDNS消息
  # strict_acks: true # 设置为false以禁用LiveKit作为拨号方的对等连接的严格ACK，即订阅者对等连接。禁用严格ACK将防止未ACK对等连接的客户端被监视器踢出房间。注意，如果禁用严格ACK且客户端未ACK打开的对等连接，则只有可靠的有序交付可用。
  # # 启用批量写入以合并网络写入系统调用，减少CPU使用。出站数据包将排队，直到队列长度达到`batch_size`或上次写入后经过的时间超过`max_flush_interval`。
  # batch_io:
  #    batch_size: 128
  #    max_flush_interval: 2ms
  # data_channel_max_buffered_amount: 0 # 数据通道的最大缓冲字节数。0表示无限制。当超过此限制时，数据消息将被丢弃，直到缓冲量低于此限制

# prometheus_port: 6789 # 启用后，LiveKit将在:6789/metrics暴露prometheus指标

# API密钥/密钥对，密钥用于JWT认证，服务器API需要密钥对来生成访问令牌，并对服务器进行调用
keys:
  key1: secret1
  key2: secret2

# 日志配置
# logging:
#   level: info # 日志级别，debug、info、warn、error
#   pion_level: error # pion库的日志级别，默认为error
#   json: false # 设置为true时，输出JSON格式的日志
#   sample: false # 对于生产环境，启用采样算法：https://github.com/uber-go/zap/blob/master/FAQ.md#why-sample-application-logs

# 默认房间配置，创建的每个房间都将继承这些设置。如果使用CreateRoom显式创建房间，这些设置将优先于默认值
# room:
#   # auto_create: false # 参与者加入时是否自动创建房间，默认为true
#   empty_timeout: 300 # 无人加入时保持房间打开的秒数
#   departure_timeout: 20 # 所有人都离开后保持房间打开的秒数
#   max_participants: 0  # 房间中参与者的数量限制，0表示无限制
#   # 仅接受客户端发布到此房间的特定编解码器，这有助于标准化客户端间的编解码器，其他支持的编解码器包括video/h264、video/vp9、video/av1、audio/red
#   enabled_codecs:
#     - mime: audio/opus
#     - mime: video/vp8
#   # 允许远程取消静音轨道，默认为false，始终可以通过Room Service API静音轨道
#   enable_remote_unmute: true
#   # 控制视频轨道(及关联音频轨道)的播放延迟(毫秒)
#   playout_delay:
#     enabled: true
#     min: 100
#     max: 2000
#   sync_streams: true # 当playout_delay设置为大于200ms时改善音视频同步。它将禁用收发器重用，因此不建议用于订阅频繁变化的房间

# 配置后，LiveKit将通过房间事件通知您的URL处理程序
# webhook:
#   api_key: <api_key> # 用于签署消息的API密钥，必须与LiveKit配置的密钥之一匹配
#   urls: # 要通知房间事件的URL列表
#     - https://your-host.com/handler

# 信号中继，自v1.4.0起，提供了基于psrpc的更可靠的信号中继功能，这使我们能够在信号服务器和RTC节点之间可靠地代理消息
# signal_relay:
#   retry_timeout: 30s # 消息传递尝试失败前的重试时间
#   min_retry_interval: 500ms # 等待RTC节点确认的最小时间，重试时每次后续尝试的等待时间呈指数增长，上限为max_retry_interval
#   max_retry_interval: 5s # 等待RTC节点确认的最大时间
#   stream_buffer_size: 1000 # 丢弃前缓冲的消息数量

# 自v1.5.1起，提供了基于psrpc的更可靠的内部RPC
# psrpc:
#   max_attempts: 3 # 最大RPC尝试次数
#   timeout: 500ms  # 等待调用完成的初始时间
#   backoff: 500ms  # 每次失败后添加到超时的时间量
#   buffer_size: 1000 # 丢弃前缓冲的消息数量

# 自定义音频电平敏感度
# audio:
#   active_level: 30 # 被视为活动的最小电平，0-127，0为最大声，默认为30
#   min_percentile: 40 # 测量的百分位数，如果参与者在超过MinPercentile%的时间内超过ActiveLevel，则被视为活动，默认为40
#   update_interval: 500 # 通知客户端变化的频率(毫秒)，默认为500
#   smooth_intervals: 4 # 防止发言者更新过于跳跃，对N个样本进行平滑处理
#   active_red_encoding: true # 为纯opus音频上行轨道启用下行red编码

# TURN服务器配置
# turn:
#   # 使用TLS。需要证书和密钥pem文件，可通过以下方式提供：
#   # - 如果使用helm图表部署，使用turn.secretName，或
#   # - 设置LIVEKIT_TURN_CERT和LIVEKIT_TURN_KEY环境变量指向文件位置，或
#   # - 使用下面的cert_file和key_file
#   enabled: false # 默认为false
#   udp_port: 3478 # 默认为3478 - 如果不运行HTTP3/QUIC服务器，建议设为443，如果端口小于1024，只允许53/80/443
#   tls_port: 5349 # 默认为5349 - 如果不使用负载均衡器，必须设置为443
#   relay_range_start: 1024 # 设置TURN中继连接到LiveKit SFU的UDP端口范围，默认使用任何可用端口
#   relay_range_end: 30000
#   external_tls: true # 如果使用L4负载均衡器终止TLS，请将external_tls设置为true。启用后，LiveKit在tls_port上期望未加密的流量，但仍将tls_port广告为TURN/TLS候选
#   domain: turn.myhost.com  # 需要与tls证书域匹配
#   # 可选(仅当不使用外部TLS终止时设置)
#   # cert_file: /path/to/cert.pem
#   # key_file: /path/to/key.pem

# 入口服务器配置
# ingress:
#   rtmp_base_url: "rtmp://my.domain.com/live"  # 用于生成RTMP入口的RTMP URL前缀
#   whip_base_url: "http://my.domain.com/whip" # 用于生成WHIP入口的WHIP URL前缀

# region: us-west-2 # 当前节点的区域。如果使用区域感知节点选择器，则需要此配置

# # 节点选择器配置
# node_selector:
#   kind: sysload # 默认：any。有效值：any、sysload、cpuload、regionaware
#   sort_by: sysload # 当有多个节点可用时，选择节点的优先级，默认：random。有效值：random、sysload、cpuload、rooms、clients、tracks、bytespersec
#   algorithm: lowest # 用于从排序节点中选择的算法，默认：lowest。有效值：lowest、twochoice
#   sysload_limit: 0.7 # 用于sysload和regionaware模式，如果每CPU负载超过sysload_limit，则不将房间分配给节点
#   regions:  # 用于regionaware模式，区域列表及其经纬度坐标
#     - name: us-west-2
#       lat: 44.19434095976287
#       lon: -123.0674908379146

# # 节点限制配置，设置为-1以禁用限制
# limit:
#   num_tracks: -1 # 默认为每CPU 400个进出轨道，最多8000个
#   bytes_per_sec: 1_000_000_000 # 默认为1 GB/s，或略低于10 Gbps
#   subscription_limit_video: 0 # 单个参与者可以同时订阅的轨道数量(音频/视频)，如果超过限制，订阅将处于待处理状态，直到任何已订阅的轨道被取消订阅，小于或等于0的值表示无限制
#   subscription_limit_audio: 0
#   max_metadata_size: 0 # 房间和参与者元数据的大小限制，0表示无限制
#   max_attributes_size: 0 # 参与者属性的大小限制，0表示无限制
#   max_room_name_length: 0 # 房间名称的长度限制
#   max_participant_identity_length: 0 # 参与者身份标识的长度限制